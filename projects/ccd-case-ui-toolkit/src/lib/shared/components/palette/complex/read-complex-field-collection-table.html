<div class="complex-panel" [hidden]="caseField.hidden">
  <dl class="complex-panel-title">
    <dt><span class="text-16">{{caseField.label | rpxTranslate}}</span></dt>
    <dd></dd>
  </dl>
  <table class="complex-panel-table" aria-describedby="complex panel table">
    <tbody>
      <!-- <COMPLEX table field header>-->
      <tr>
        @for (heading of columns; track heading) {
          <th scope="col">
            <span class="text-16">{{columnsAllLabels[heading].label | rpxTranslate}}</span>
            <a href="javascript:void(0)"
              (click)="sortRowsByColumns(heading)"
              (keyup.enter)="sortRowsByColumns(heading)"
              class="sort-widget"
              [attr.aria-label]="'Sort ' + columnsAllLabels[heading].label | rpxTranslate"
            [innerHTML]="sortWidget(columnsAllLabels[heading])"></a>
          </th>
        }
        <th></th>
      </tr>
      <!-- </COMPLEX table field header>-->
      @for (item of rows; track item; let i = $index) {
        <!-- <COMPLEX table collapsed view>-->
        <tr class="new-table-row accordion-heading" (keyup)="$event.key === 'Enter' ? (isHidden[i] = !isHidden[i]) : null" (click)="isHidden[i] = !isHidden[i]"
          [class.last-accordion]="isHidden[i]">
          @for (heading of columns; track heading) {
            <td class="text-16">
              @if (item[heading]) {
                <div>
                  <ccd-field-read
                    [caseField]="toCaseField(heading, item[heading].label, columnsHorizontalLabel[heading].type, item[heading])"
                  [context]="context"></ccd-field-read>
                </div>
              } @else {
                <div>&nbsp;</div>
              }
            </td>
          }
          <td>
            <div style="float: right;">
              <a href="javascript:void(0)"> <img src="{{ getImage(i) }}" alt="accordion-img" class="accordion-image"/></a>
            </div>
          </td>
        </tr>
        <!-- </COMPLEX table collapsed view>-->
        <!-- <COMPLEX table expanded view>-->
        <tr [hidden]="isHidden[i]">
          <td [colSpan]="columns.length + 1">
            <table class="complex-panel-table" aria-describedby="complex panel table expanded">
              <tbody>
                @for (vLabel of columnsVerticalLabel | keyvalue: keepOriginalOrder | ccdCollectionTableCaseFieldsFilter: caseField: rows[i] | ccdReadFieldsFilter:true :undefined :true; track vLabel) {
                  <!-- <COMPLEX table expandable body simple field>-->
                  @if (item[vLabel.id]) {
                    <tr class="complex-panel-simple-field accordion-body" [hidden]="vLabel.hidden">
                      <th scope="col"><span class="text-16">{{ vLabel.label | rpxTranslate }}</span></th>
                      @if (vLabel['type'] !== 'Complex') {
                        <td class="text-16">
                          <ccd-field-read [caseField]="toCaseField('', vLabel.label, vLabel.field_type, item[vLabel.id])"
                          [context]="context"></ccd-field-read>
                        </td>
                      }
                    </tr>
                  }
                  <!-- </COMPLEX table expandable body simple field>-->
                  <!-- <COMPLEX table expandable body complex field>-->
                  @if (vLabel['type'] === 'Complex' && addCaseFieldValue(vLabel, item[vLabel.id])) {
                    <tr [hidden]="vLabel.hidden">
                      <td colspan="2">
                        @for (caseField of vLabel | ccdReadFieldsFilter:true :undefined :true; track caseField) {
                          @if ((caseField | ccdIsCompound)) {
                            <tr class="complex-panel-compound-field" [hidden]="caseField">
                              <td colspan="2">
                                <span class="text-16"><ccd-field-read [caseField]="caseField" [context]="context"></ccd-field-read></span>
                              </td>
                            </tr>
                          } @else {
                            <tr class="complex-panel-nested-field" [hidden]="caseField.hidden">
                              <th scope="col"><span class="text-16">{{caseField.label | rpxTranslate}}</span></th>
                              @if (!item[vLabel.id]?.hasOwnProperty('CaseReference')) {
                                <td>
                                  <span class="text-16"><ccd-field-read [caseField]="caseField" [context]="context"></ccd-field-read></span>
                                </td>
                              }
                              @if (item[vLabel.id]?.hasOwnProperty('CaseReference')) {
                                <td>
                                  <ccd-read-case-link-field [caseField]="addCaseReferenceValue(caseField, item[vLabel.id].CaseReference)" [context]="context"></ccd-read-case-link-field>
                                </td>
                              }
                            </tr>
                          }
                        }
                      </td>
                    </tr>
                  }
                  <!-- <COMPLEX table expandable body complex field>-->
                }
              </tbody>
            </table>
          </td>
        </tr>
        <!-- </COMPLEX table expanded view>-->
      }
    </tbody>
  </table>
</div>
