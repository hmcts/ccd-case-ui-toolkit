<div class="document-filter-container" role="search">
  <div class="form-group document-filter" [formGroup]="documentFilterFormGroup">
    <input
      class="form-control document-search"
      type="search"
      id="document-search"
      name="documentSearchFormControl"
      formControlName="documentSearchFormControl"
      placeholder="Search by document name"/>
  </div>
</div>

<div class="document-folders-header">
  <div class="document-folders-header__title">Documents ({{ documentCount }})</div>
  <div class="document-folders-header__flex">
    <ccd-case-file-view-folder-toggle
      (expandAll)="expandAll($event)"
      (collapseAll)="collapseAll($event)">
    </ccd-case-file-view-folder-toggle>
    <ccd-case-file-view-folder-sort
      (sortAscending)="sortDataSourceAscending($event)"
      (sortDescending)="sortDataSourceDescending($event)">
    </ccd-case-file-view-folder-sort>
  </div>
</div>

<div class="document-tree-container" *ngIf="documentTreeData">
  <div *ngIf="!nestedDataSource || nestedDataSource.length === 0">
    No results found
  </div>
  <div>
    <cdk-tree
      [dataSource]="nestedDataSource"
      [treeControl]="nestedTreeControl"
      role="tree"
      aria-label="Case documents">
      <!-- document -->
      <cdk-nested-tree-node class="document-tree-container__node document-tree-container__node--document" *cdkTreeNodeDef="let node">
        <button
          type="button"
          class="node case-file__node"
          role="treeitem"
          aria-expanded="false"
          [attr.aria-label]="node.name"
          (click)="selectedNodeItem = node; clickedDocument.emit(node)"
          [class.node--selected]="selectedNodeItem?.name === node.name">
          <div class="node__icon" disabled aria-hidden="true">
            <img src="/assets/img/case-file-view/case-file-view-document.svg"
              class="node__iconImg"
              alt=""
              aria-hidden="true"
            />
          </div>
          <span class="node__name node-name-document">
            {{ node.name }}
            <br />
            <span class="node__document-upload-timestamp">{{
              node.upload_timestamp | ccdDate: "local":"dd MMM yyyy HH:mm"
              }}</span>
          </span>
        </button>
        <div class="node__document-options case-file__action">
          <ccd-case-file-view-folder-document-actions
            (changeFolderAction)="triggerDocumentAction('changeFolder', node)"
            (openInANewTabAction)="triggerDocumentAction('openInANewTab', node)"
            (downloadAction)="triggerDocumentAction('download', node)"
            (printAction)="triggerDocumentAction('print', node)"
            [allowMoving]="allowMoving"
          >
          </ccd-case-file-view-folder-document-actions>
        </div>
      </cdk-nested-tree-node>
      <!-- folder-->
      <cdk-nested-tree-node class="document-tree-container__node document-tree-container__folder" *cdkTreeNodeDef="let node; when: nestedChildren">
        <button
          type="button"
          class="node"
          cdkTreeNodeToggle
          role="treeitem"
          [attr.aria-expanded]="nestedTreeControl.isExpanded(node)"
          [attr.aria-label]="node.name + ' folder, ' + node.childDocumentCount + ' documents'">
          <div class="node__icon" aria-hidden="true">
            <img class="node__iconImg"
                [src]="nestedTreeControl.isExpanded(node)
                  ? '/assets/images/folder-open.png'
                  : '/assets/images/folder.png'
              "
              alt="Folder icon"
              aria-hidden="true" />
            <span class="node__count">{{ node.childDocumentCount }}</span>
          </div>
          <span class="node__name node__name--folder">{{ node.name }}</span>
        </button>
        <div
          role="group"
          [class.document-tree-invisible]="!nestedTreeControl.isExpanded(node)">
          <ng-container cdkTreeNodeOutlet></ng-container>
        </div>
      </cdk-nested-tree-node>
    </cdk-tree>
  </div>
</div>
