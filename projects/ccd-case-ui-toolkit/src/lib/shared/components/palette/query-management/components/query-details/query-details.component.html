@if (query) {
  @if (showItem) {
    <p>
      <br />
      <a class="govuk-link" href="javascript:void(0)" (click)="onBack()">{{ 'Back to query list' | rpxTranslate }}</a>
    </p>
  }
  <div>
    <table class="govuk-table query-details-table" [attr.aria-describedby]="'Details of the query' | rpxTranslate">
      <caption class="govuk-table__caption govuk-table__caption--l">
        <div>{{ 'Query details' | rpxTranslate }}</div>
      </caption>
      <tbody class="govuk-table__body">
        <tr class="govuk-table__row">
          <th scope="row" class="govuk-table__header">{{ 'Last submitted by' | rpxTranslate }}</th>
          <td class="govuk-table__cell">{{ query.lastSubmittedBy }}</td>
        </tr>
        <tr class="govuk-table__row">
          <th scope="row" class="govuk-table__header">{{ 'Submission date' | rpxTranslate }}</th>
          <td class="govuk-table__cell">{{ query.createdOn | date: 'dd MMMM YYYY HH:mm' }}</td>
        </tr>
        <tr class="govuk-table__row">
          <th scope="row" class="govuk-table__header">{{ 'Query subject' | rpxTranslate }}</th>
          <td class="govuk-table__cell">{{ query.subject }}</td>
        </tr>
        <tr class="govuk-table__row">
          <th scope="row" class="govuk-table__header">{{ 'Query body' | rpxTranslate }}</th>
          <td class="govuk-table__cell">{{ query.body }}</td>
        </tr>
        <tr class="govuk-table__row">
          <th scope="row" class="govuk-table__header" [class.govuk-table__header--no-border]="query.isHearingRelated">
            {{ 'Is the query hearing related?' | rpxTranslate }}
          </th>
          <td class="govuk-table__cell" [class.govuk-table__cell--no-border]="query.isHearingRelated">
          {{ 'Is the query hearing related?' | rpxTranslate: null : (query.isHearingRelated) }}</td>
        </tr>
        @if (query.isHearingRelated === 'Yes') {
          <tr class="govuk-table__row govuk-table__row--isHearingRelated">
            <th scope="row" class="govuk-table__header">{{ 'What is the date of the hearing?' | rpxTranslate }}</th>
            <td class="govuk-table__cell">{{ query.hearingDate | date: 'dd MMM yyyy' }}</td>
          </tr>
        }
        @if (query.attachments.length > 0) {
          <tr class="govuk-table__row">
            <th scope="row" class="govuk-table__header">{{ 'Attachments' | rpxTranslate }}</th>
            <td class="govuk-table__cell">
              @if (query.attachments) {
                <ccd-query-attachments-read
                  [attachments]="query.attachments"
                  >
                </ccd-query-attachments-read>
              }
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
  @if (query.children?.length > 0) {
    @for (child of query.children; track child; let i = $index) {
      @if (i % 2 === 0) {
        <table class="govuk-table query-details-table" [attr.aria-describedby]="'Response of the query' | rpxTranslate">
          <caption class="govuk-table__caption govuk-table__caption--l">
            <div>{{ 'Response' | rpxTranslate }}</div>
          </caption>
          <tbody class="govuk-table__body">
            <tr class="govuk-table__row">
              <th scope="row" class="govuk-table__header">{{ 'Last response date' | rpxTranslate }}</th>
              <td class="govuk-table__cell">{{ child.createdOn | date: 'dd MMMM YYYY HH:mm'  }}</td>
            </tr>
            @if (isInternalUser()) {
              <tr class="govuk-table__row">
                <th scope="row" class="govuk-table__header">{{ 'Caseworker name' | rpxTranslate }}</th>
                <td class="govuk-table__cell">{{ child.name }}</td>
              </tr>
            }
            <tr class="govuk-table__row">
              <th scope="row" class="govuk-table__header">{{ 'Response detail' | rpxTranslate }}</th>
              <td class="govuk-table__cell">{{ child.body }}</td>
            </tr>
            @if (child.attachments.length > 0) {
              <tr class="govuk-table__row">
                <th scope="row" class="govuk-table__header">{{ 'Attachments' | rpxTranslate }}</th>
                <td class="govuk-table__cell">
                  @if (child.attachments) {
                    <ccd-query-attachments-read
                      [attachments]="child.attachments"
                      >
                    </ccd-query-attachments-read>
                  }
                </td>
              </tr>
            }
          </tbody>
        </table>
      } @else {
        <!-- <div class="query_details_caption">{{ 'Follow-up' | rpxTranslate }}</div> -->
        <table class="govuk-table query-details-table"
          [attr.aria-describedby]="'Follow-up of the response' | rpxTranslate">
          <caption class="govuk-table__caption govuk-table__caption--l">
            <div>{{ 'Follow up query' | rpxTranslate }}</div>
          </caption>
          <tbody class="govuk-table__body">
            <tr class="govuk-table__row">
              <th scope="row" class="govuk-table__header">{{ 'Last submission date' | rpxTranslate }}</th>
              <td class="govuk-table__cell">{{ child.createdOn | date: 'dd MMMM YYYY HH:mm'}}</td>
            </tr>
            <tr class="govuk-table__row">
              <th scope="row" class="govuk-table__header">{{ 'Last submitted by' | rpxTranslate }}</th>
              <td class="govuk-table__cell">{{ child.name }}</td>
            </tr>
            <tr class="govuk-table__row">
              <th scope="row" class="govuk-table__header">{{ 'Query detail' | rpxTranslate }}</th>
              <td class="govuk-table__cell">{{ child.body }}</td>
            </tr>
            @if (child.attachments.length > 0) {
              <tr class="govuk-table__row">
                <th scope="row" class="govuk-table__header">{{ 'Attachments' | rpxTranslate }}</th>
                <td class="govuk-table__cell">
                  @if (child.attachments) {
                    <ccd-query-attachments-read
                      [attachments]="child.attachments"
                      >
                    </ccd-query-attachments-read>
                  }
                </td>
              </tr>
            }
          </tbody>
        </table>
      }
    }
  }
}
