<ng-container *ngIf="flagTypes?.length" [formGroup]="formGroup">
  <div class="govuk-form-group" [ngClass]="{'form-group-error': flagTypeNotSelectedErrorMessage.length > 0}">
    <fieldset class="govuk-fieldset" aria-describedby="flag-type-heading">
      <legend class="govuk-fieldset__legend govuk-fieldset__legend--l">
        <h1 id="flag-type-heading" class="govuk-fieldset__heading govuk-!-margin-bottom-1">
          <ng-container *ngIf="!selectionTitle; else selectionTitlePresent">
            {{
              isDisplayContextParameterExternal
                ? (caseFlagWizardStepTitle.SELECT_CASE_FLAG_EXTERNAL | rpxTranslate)
                : (caseFlagWizardStepTitle.SELECT_CASE_FLAG | rpxTranslate)
            }}
          </ng-container>
          <ng-template #selectionTitlePresent>
            {{selectionTitle | rpxTranslate}}
          </ng-template>
        </h1>
      </legend>
      <div id="flag-type-not-selected-error-message" class="govuk-error-message"
        *ngIf="flagTypeNotSelectedErrorMessage.length > 0">
        <span class="govuk-visually-hidden">Error:</span> {{flagTypeNotSelectedErrorMessage | rpxTranslate}}
      </div>
      <div class="govuk-radios govuk-radios--conditional" data-module="govuk-radios" id="conditional-radios-list">
        <div class="govuk-radios__item" *ngFor="let flagType of flagTypes; index as i">
          <!-- All parent flag types have the same flagCode of "CATGRY", so each radio button value needs to be made
            unique by appending the index - radio buttons shouldn't share the same value.
            It is OK to amend flagCode this way because parent flag types cannot be selected as a final value -->
          <input class="govuk-radios__input" id="flag-type-{{i}}" [name]="caseFlagFormField.FLAG_TYPE"
            type="radio" [value]="flagType"
            [formControlName]="caseFlagFormField.FLAG_TYPE"/>
          <label class="govuk-label govuk-radios__label" for="flag-type-{{i}}">{{flagType.name | rpxTranslate}}</label>
        </div>
        <div class="govuk-radios__conditional" *ngIf="otherFlagTypeSelected" id="conditional-flagType">
          <div class="govuk-form-group" [ngClass]="{'form-group-error': flagTypeErrorMessage.length > 0}">
            <label class="govuk-label" for="other-flag-type-description">
              {{
                isDisplayContextParameterExternal
                  ? (caseFlagWizardStepTitle.OTHER_FLAG_TYPE_DESCRIPTION_EXTERNAL | rpxTranslate)
                  : (caseFlagWizardStepTitle.OTHER_FLAG_TYPE_DESCRIPTION | rpxTranslate)
              }}
            </label>
            <div id="flag-type-error-message" class="govuk-error-message" *ngIf="flagTypeErrorMessage.length > 0">
              <span class="govuk-visually-hidden">Error:</span> {{flagTypeErrorMessage | rpxTranslate}}
            </div>
            <input class="govuk-input govuk-!-width-one-half"
              [ngClass]="{'govuk-input--error': flagTypeErrorMessage.length > 0}"
              id="other-flag-type-description" [name]="caseFlagFormField.OTHER_FLAG_DESCRIPTION" type="text"
              [formControlName]="caseFlagFormField.OTHER_FLAG_DESCRIPTION"/>
          </div>
        </div>
      </div>
    </fieldset>
  </div>
</ng-container>

<div class="govuk-button-group" *ngIf="!refdataError">
  <button class="button button-primary" type="button" (click)="onNext()">{{'Next' | rpxTranslate}}</button>
</div>
